# 7장 권한 부여 구성 : 엑세스 제한

## 이 단원의 내용

- PasswordEncoder의 구현 및 이용
- 스프링 시큐리티 암호화 모듈에 있는 툴 이용

![Untitled](7%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%A6%E1%86%A8%E1%84%89%E1%85%A6%E1%84%89%E1%85%B3%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20eb04ce83e285432ba7aa41678d87ad22/Untitled.png)

## 7.1 권한과 역활에 따라 접근 제한

- 권환과 역활은 애플리케이션의 모든 엔드포인트(URL)을 보호하는데 이용된다.
- 애플리케이션 이용 권리를 권한과 역활로서 제공한다.
- GrantedAuthority 인터페이스는 주로 권한 부여 프로세스와 연관된다.
- GrantedAuthority에서 권한은 getAuthority()로 String 형식으로 반환하는 값에서 얻을 수 있다.
- 권한의 이름은 맞춤형 권한 부여 규칙을 정의할 때 필요

1.  사용자 권한을 기준으로 모든 엔드포인트에 접근 제한
    - 배울 메서드
        - hasAuthority() : 애플리케이션이 제한을 구성하는 하나의 권한만 매개 변수로 받는다. 해당 권한이 있는 사용자만 엔드포인트를 호출할 수 있다.
        - hasAnyAuthority() : 사용자에게 주어진 권한 중 하나라도 있을 때 엔드포인트를 호출 할 수 있다.
        - access() : SpEL(Spring Expression Language)을 기반으로 권한 부여 규칙을 구축한다.
        - 엑세스를 구성하는데 무한한 가능성이 있지만 디버깅이 어려운 단점이 있다. 추천 않하며 위의 두 메서드로는 처리되지 않을 때 사용하는 것이 좋다.
2. 사용자 역할을 기준으로 모든 엔드포인트에 대한 접근 제한
    - 역할은 사용자가 수행할 수 있는 작업을 나타내는 다른 방법
    - 역할과 권한의 차이점을 이해하는 게 중요
        - 권한 = 행동(READ,WRITE,DELETE 등) → fine grained
        - 역할 = 작업 그룹에 속한 이용 권리를 제공(관리자, 사용자) → coarse-grained
            - 관리자 : READ, WRITE, DELETE 등
            - 사용자 : READ
    - 역할의 이름은 개발자가 선택 가능하다.
    - 권한과 마찬가지로 GrantedAuthority 에서 authorities() 메소드에 나타낸다.
    - 하지만 역할은 “ROLE_xxx” 형태의 접두사로 시작해야 한다.
    - 배울 메서드
        - hsRole() : 요청을 승인할 하나의 역할 이름을 매개 변수로 받는다.
        - hsAnyRole() : 요청을 승인할 여러 역할 이름을 매개 변수로 받는다.
        - access() : 역활을 SpEL 식으로 작성하여 지정한다.
3. 모든 엔드포인트에 대한 접근 제한
    - 엔드포인트에 특정 조건에 한해서 접근을 거부하는 것
        
        ![Untitled](7%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%A6%E1%86%A8%E1%84%89%E1%85%A6%E1%84%89%E1%85%B3%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20eb04ce83e285432ba7aa41678d87ad22/Untitled%201.png)
        
    - 호출 경로에 따라 서비스에 접근을 거부하게 할 수 있다.
        
        ![Untitled](7%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%A6%E1%86%A8%E1%84%89%E1%85%A6%E1%84%89%E1%85%B3%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20eb04ce83e285432ba7aa41678d87ad22/Untitled%202.png)
        

### 요약

- 권한 부여는 애플리케이션이 인증(Authectication)된 요청을 허가할지 결정하는 프로세스. = Authorization
- 애플리케이션이 인증된 사용자의 권한과 역할에 따라 권한을 부여하는 방법을 구성 = hasRole()
- 애플리케이션에서 인증되지 않은 사용자가 특정 요청을 수행할 수 있게 지정할 수도 있다. = ?
- denyAll() 메서드로 앱이 모든 요청을 거부하고 PermitAll 메서드로 모든 요청을 수락하게 할 수 있다.
-
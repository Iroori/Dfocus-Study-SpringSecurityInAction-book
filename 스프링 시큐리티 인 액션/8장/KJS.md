# 8장 권한 부여 구성 : 제한 적용

## 이 단원의 내용

- 특정 요청 그룹에만 권한 부여 제약 조건을 적용하는 방법을 배운다.
- 모든 요청에 동일한 규칙을 적용하는 경우는 드물다.
- 사용자에 따라 특정 엔드포인트의 호출을 허용할 수 있다.
- 권한 부여 구성을 적용할 요청을 선택하는데 선택기 메소드를 사용한다.
    - MVC 선택기 : 경로에 MVC 식을 이용해 엔드포인트 선택
    - 앤트 선택기 : 경로에 앤트 식을 이용해 엔드포인트 선택
    - 정규식 선택기 : 경로에 정규식(regex) 식을 이용해 엔드포인트 선택

## 8.1 선택기 메서드로 엔드포인트 선택

- 특정 엔드포인트에 권한에 따라 호출 여부를 제한할 수 있다.
- 제한된 경우에는 403 에러를 반환한다.
- 선택기 메서드 보다 anyRequest() 메서드가 먼저 나올 수 없다.
- 사용자 정보가 틀리다면 선택기 메서드 이전에 401 에러가 발생한다.
- 이외의 모든 요청을 어떻게 처리할지는 permitAll(), authenticated() 메서드를 골라 설정하면 된다.

### 선택 예제 코드

![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled.png)

![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled%201.png)

## 8.2 MVC 선택기로 권한을 부여할 요청 선택

- 일반적으로 MVC 식을 이용하여 권한 부여 구성을 적용할 요청을 지정한다.
- 메서드 사용 방법
    
    ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled%202.png)
    
- 엔드포인트의 요청 방식에 따라서도 제한할 수 있다.
    
    ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled%203.png)
    
- 제한해야 할 엔드포인트들이 많다면 코드가 장황해져 가독성이 않좋다. 이를 해결하기 위해 경로 식을 이용하면 된다(** 연산자)
    - ** 연산자는 경로 중간에도 사용할 수 있다.(/a/b/**/c)
    
    ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled%204.png)
    
- 응용 형태로 특정 문자 형식만 허용하는 것도 가능하다.
    
    ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled%205.png)
    
    ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled%206.png)
    
- MVC에 사용 할 수 있는 식의 예제

![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled%207.png)

## 8.3 앤트 선택기로 권한을 부여할 요청 선택

- 근래에는 MVC 선택기를 많이 사용하지만, 이전에는 앤트 선택기를 많이 사용했었기 때문에 차이점을 이해하고 있어야 한다.
- 앤트 선택기 메서드
    
    ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled%208.png)
    
- MVC 선택기는 컨트롤러 동작에 대한 일치 요청을 이해하는 방법을 정확하게 지정한다.
    - 즉 경로의 하위 경로까지도 보호를 한다는 의미
        - EX : /hello 와 /hello/는 동일한 엔드포인트를 호출한다
        - 여기서 MVC 는 둘 다 보호하지만
        - 앤트는 /hello만 보호한다. /hello/는 보호하지 않는다.

## 8.4 정규식 선택기로 권한 부여할 요청 선택

- MVC나 앤트로는 해결할 수 없는 특정 요구 사항에 적용할 수 있다.
    - EX : 경로에 특정 기호 또는 문자가 있을 경우에 deyAll()
- 정규식 선택기 메서드
    
    ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled%209.png)
    
- 기본적으로는 MVC나 앤트는 경로에 하나의 변수를 이용하는 조건에 적합하다.
- N개의 변수가 경로에 있다면 정규식이 편리하다.
    
    ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled%2010.png)
    
- 예제
    - 기본적으로 두개의 변수 모두가 정상일 때 호출이 된다.
    
    ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled%2011.png)
    
    ![Untitled](8%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%AE%E1%84%8B%E1%85%A7%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%AD%E1%86%BC%20665d981af7e84b389467470b46c83faa/Untitled%2012.png)
    

### 요약

- 실제 시나리오에서는 요청마다 다른 권한 부여 규칙을 적용하는 경우가 많다.(SeedVDI)
- 경로와 HTTP 방식에 따라 권한 부여 규칙을 구성할 요청을 지정할 수 있다.
- 규칙을 구성할 때 3가지의 선택기를 이용하여 구성할 수 있다.
    - MVC, 앤트, 정규식
- MVC와 앤트 선택기는 비슷하지만 MVC를 추천한다.
    - MVC는 컨트롤러 동작에 대한 일치 요청을 이해하는 방법을 정확히 지정함.
        - EX : /hello/, /hello 모두 동일한 컨트롤러로 서 이해한다.
- 요구 사항이 앤트나 MVC로 해결이 어려울 경우 정규식으로 해결할 수 있다.
    - 경로에 2개 이상의 변수가 있다면 특히 유용하다.